## VPN

## Управление IP адресом клиента

Чтобы отправлять данные через **VPN** туннель,
клиент должен получить выделенный внутренний **IP** адрес от сервера

Чтобы его получить для MVP предлагается использовать **http** запрос при клиента

### Как это будет работать:

- клиент стартует
- клиент отправляет **http** запрос для получения выделенного **IP** адреса
- после получения этого адреса, клиент может настроить свою сеть для маршрутизации трафика
  через нужный **tun** интерфейс

### Что если поменялся IP адрес клиента?

#### Проблема:

Клиенты это обычные пользователи, которые чаще всего находятся за **NAT**-ом провайдера
Соответственно у них динамический **IP** адрес

Если их **IP** поменяется и сервер об этом ничего не будет знать, соединение перестанет работать,
так как сервер будет пытаться слать пакеты на старый **IP** адрес

#### Решение:

Чтобы избежать потери соединения, клиент будет отправлять служебные **healthcheck** пакеты
для того, чтобы актуализировать маппинг реального **IP** адреса клиента с **IP** адресом, который выделил сервер

### Что если роутер/провайдер сбрасывает UPD порт по таймауту?

#### Проблема:

UDP протокол не имеет соединения
При передаче данных по **UDP** роутер/провайдер обновляет таблицу **NAT**, чтобы **UDP** трафик проходил к нужному узлу

Но роутер/провайдер не знают как долго они должны держать открытые порты именно для этого соединения
Поэтому есть таймаут, который позволяет им закрывать соединение, если какое-то время не было трафика

Как итог соединение может оборваться, если клиент перестал слать или получать пакеты

#### Решение:

Решают эту проблему тот же механизм **healthcheck**, которые будут использоваться для актуализации реального **IP**
адреса